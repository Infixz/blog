[python]如何在生产环境下更新 tornado 项目代码
==========================================

:date: 2015-03-27
:slug: how-to-restart-or-update-tornado-code-on-fly-in-production


本文将讲述一种在线上环境下更新 tornado 项目代码或者说重启 tornado HTTP 服务的方法。

一般 tornado HTTP 服务都类似下面这样的：

* 用 nginx 做负载均衡和静态文件服务器
* 同时起多个 tornado 进程服务多个端口

在线上重启 tornado 服务的思路如下：

1. 更新代码
2. 使用不同的端口启动新的 tornado 服务
3. 更改 nginx 配置，将新端口加入到负载均衡配置中，降低旧服务端口的权重
4. 应用新的 nginx 配置
5. 更新 nginx 配置，删除/注释掉旧服务的端口配置
6. 应用新的 nginx 配置
7. 停止旧的 tornado 服务